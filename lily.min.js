/*
 lily.js a.k.a. LIght LibrarY JavaScript (c) 2011 ofk
 lily is licensed under the MIT.
*/
var ll=function(){function O(a,b){b+="";var c=a+b,d;if(!(d=P[c])){d=P;var e;if(b[Q](0)===y){e=y+a;var g;g=(""+b[F](1))[G](R,S);e+=g}else e=a+(""+b)[G](R,S);d=d[c]=e}return d}function H(a,b){b+="";var c=a+b;return T[c]||(T[c]=b[Q](0)===y?y+a+b[F](1)[U]():a+b[U]())}function t(){}function i(a){return a==null?-1:a[i[I]]||(a[i[I]]=++i[V])}function j(a){var b=typeof a;return W[b]||(b=W[ia[h](a)])?b:!a?ja:a[ka]?la:a[ma]?na:o in a&&typeof(b=a[o])===p&&(!b||b-1 in a)?z:u}function q(a){a==null&&(a={});for(var b=
arguments,c=1,d=b[o];c<d;++c){var e=b[c];if(e!=null)for(var g in e)a[g]=e[g]}return a}function J(a,b,c){if(j(a)===z)for(var d=0,e=a[o];d<e;++d){if(d in a&&b[h](c,a[d],d,a)===false)return false}else for(d in a)if(a[oa](d)&&b[h](c,a[d],d,a)===false)return false;return true}function l(){}function A(){}function K(a,b){a[h](b+X,b);a[h](X,b);a[h](L+b)}function x(){}function M(a,b,c){switch(j(a)){case Y:return a;case p:case N:return""+b===""+a;case Z:return a[pa](b);case k:return!!a[h](c,b);default:return null}}
function f(){}var y="_",m="_llqueue",L="_notify",v="apply",z="array",Y="boolean",h="call",X="change",Q="charAt",V="counter",$="error",k="function",oa="hasOwnProperty",I="key",o="length",aa="load",na="node",ma="nodeType",ja="null",p="number",u="object",B="onerror",ba="onload",ca="onreadystatechange",Z="regexp",qa="removeChild",da="removeEventListener",G="replace",ka="setTimeout",F="slice",ea="splice",N="string",pa="test",U="toLowerCase",la="window",C=TypeError,D=Date,fa=isFinite,ga=Array.prototype[F];
q(t,{guid:i,type:j,merge:q,each:J,Slot:l,KVObject:A,Dispatch:x,Deferred:f});var R=/^[^a-zA-Z0-9]*[a-z]/,S=function(a){return a.toUpperCase()},P={},T={};i[I]="_llguid";i[V]=0;var W={undefined:1,"boolean":1,number:1,string:1,"[object Boolean]":Y,"[object Number]":p,"[object String]":N,"[object RegExp]":Z,"[object Array]":z,"[object Function]":k,"[object Date]":"date"},ia=Object.prototype.toString;l.createHandle=function(){function a(){for(var b=a[m],c=0,d=b[o];c<d;++c)b[c][v](this,arguments)===false&&
(b[ea](c--,1),--d)}a[m]=[];return l.extendHandler(a,a[m])};l.createFilter=function(){function a(){for(var b=a[m],c=ga[h](arguments),d=0,e=b[o];d<e;++d)c[0]=b[d][v](this,c);return c[0]}a[m]=[];return l.extendHandler(a,a[m])};l.extendHandler=function(a,b){a.attach=function(a){if(j(a)!==k)throw new C("first argument type should be function.");i(a);b[b[o]]=a};a.detach=function(a){j(a)===k&&(a=i(a));for(var d=0,e=b[o];d<e;++d)if(a===i(b[d]))return b[ea](d,1),true;return false};return a};q(l.prototype,
{attach:function(a,b){a=H("on",a);if(!this[a]||j(this[a].attach)!==k)this[a]=l.createHandle();this[a].attach(b);return this},detach:function(a,b){a=H("on",a);if(!this[a])return true;var c=this[a];if(j(c.detach)!==k)throw new C("the handle function has no detach method.");return!b?(c[m]=[],true):c.detach(b)},call:function(a){var a=H("on",a),b=this[a];if(b&&j(b)===k)return b[v](this,ga[h](arguments,1))}});A.prototype=new l;q(A.prototype,{get:function(a){var b=this._llbindings;if(b&&(b=b[a]))return b.kvo.get(b.label);
b=O("get",a);return this[b]&&j(this[b])===k?this[b]():this[a]},set:function(a,b){var c=this._llbindings;if(c&&(c=c[a]))return c.kvo.set(c.label,b);c=O("set",a);this[c]&&j(this[c])===k?this[c](b):this[a]=b;K(this,a)},notify:function(a){var b=this._llbindings;if(b&&(b=b[a]))return b.kvo.notify(b.label);K(this,a)},bindTo:function(a,b,c,d){var e=this,c=c||a;if(!(b instanceof A))throw new C("second argument type should be [object ll.KVObject].");e.unbind(a);var g=e._llbindings=e._llbindings||{};g[a]={kvo:b,
label:c};b.attach(L+c,g[a].notify=function(){K(e,a)});d||e.notify(a)},unbind:function(a){var b=this._llbindings,c;if(b)if(a==null)for(c in b)this.unbind(c);else if(c=b[a])delete b[a],c.kvo.detach(L+c.label,c.notify),this.set(a,c.kvo.get(c.label))}});x.parseUrl=/^(\w*:\/\/)?(?:([^\/:@]+)?:([^\/:@]+)?@)?([\w\._-]+)?(?::(\d*))?(\/[^\?#]*)?(\?[^#]*)?(#.*)?$/;q(x.prototype,{update:function(a,b){a!=null&&(this._defaultLocation=a);this._defaultName=b||this._defaultName||"href"},match:function(a,b){(this._stash=
this._stash||[]).push({rule:a,callback:b});return this},call:function(){return this.run(this._defaultLocation,arguments)},run:function(a,b,c){var d=false;if(a&&this._stash){var e=this._defaultName,g;if(j(a)===N){var f=a,a={};a[e]=f}"pathname"in a||(g=x.parseUrl.exec(a[e]||""));g?q(a,{protocol:g[1]||"",hostname:g[4]||"",port:g[5]||"",pathname:g[6]||"",search:g[7]||"",hash:g[8]||""}):a=q({},a);for(var h in{pathname:1,search:1,hash:1})if(a[h]){e=h;break}c=c||a;b=b||[];g={};f=0;for(h=this._stash[o];f<
h;++f){var k=this._stash[f],i=a,l=g,n=e,r=k.rule,w=true;if(j(r)!==u)w=M(r,i[n],i);else for(n in n=void 0,r){if(!(n in i)){w=false;break}if(j(r[n])!==u){if(!M(r[n],i[n],i)){w=false;break}}else{if(!l[n]){l[n]={};for(var m=i[n][G](/^\W+/,""),t=/([^&=]+)(?:=([^&]*))?/g,p;p=t.exec(m);)l[n][p[1]]=p[2]}var m=l[n],s;for(s in r[n])if(!M(r[n][s],m[s],m)){w=false;break}if(!w)break}}if(w&&(d=true,k.callback[v](c,b)===false))break}}return d}});if(typeof location===u)t.dispatch=new x,t.dispatch.update(location);
f.delay=function(a,b){var c=setTimeout(a,b*1E3);return function(){clearTimeout(c)}};var ha=typeof window===u,s,E;f.nextTick=ha&&!window.opera&&(s=document)&&(E=s.head||s.getElementsByTagName("head")[0]||s.documentElement)?function(a){function b(){d=true;c[ba]=c[B]=c[ca]=null;E[qa](c)}var c=s.createElement("script"),d=false;c.async="async";c.src="data:text/javascript,";c[ba]=c[B]=c[ca]=function(){d||(b(),a())};E.insertBefore(c,E.firstChild);return b}:ha&&window.addEventListener?function(a){function b(){c();
a()}function c(){d[da](aa,b,false);d[da]($,b,false)}var d=new Image;d.addEventListener(aa,b,false);d.addEventListener($,b,false);d.src="data:image/png,"+Math.random();return c}:typeof process===u&&typeof process.nextTick===k?function(a){process.nextTick(a)}:null;q(f.prototype,{call:function(){return this._run("_ok",arguments)},fail:function(){return this._run("_ng",arguments)},_run:function(a,b,c){var d=a,b=b||[];if(a in this){a=this[a];if(j(a)===k)try{a=a[v](this,b),d="_ok"}catch(e){a=e,d="_ng",
f[B]&&f[B](e)}if(a instanceof f)return a._dfr=this._dfr,(!c||c(a))&&a._next(c),this;b=[a]}this._type=d;this._args=b;(!c||c(this))&&this._next(c);return this},_next:function(a){this._type&&this._dfr&&this._dfr._run(this._type,this._args,a)},then:function(a){return this._set("_ok",a)},lose:function(a){return this._set("_ng",a)},_set:function(a,b){var c=new f;c[a]=b;this._dfr=c;this._next();return c},wait:function(a){return this.then(function(){return f.wait(a)})},when:function(a){return this.then(function(){var b=
new f,c=j(a)===z?[]:{},d=1;J(a,function(a,g){++d;j(a)===k&&(a=f.then(a));a instanceof f?a.then(function(a){c[g]=a;!--d&&b[h](c)}).lose(function(a){b._run("_ng",[a],function(a){if(a._type==="_ng")return true;!--d&&b[h](c);return false})}):(c[g]=a,!--d&&b[h](c))});!--d&&b[h](c);return b})},each:function(a,b,c){return this._for(j(c)===p?{time:c}:c,a,b)},loop:function(a,b){return this._for(j(a)===p?{end:a}:a,null,b)},_for:function(a,b,c){var a=q(null,a),d=+a.start||0,e=+a.end,g=+a.step||1,j=+a.time||
0;if(b)a=b[o],!fa(e)||e>a?e=a:e<0&&(e=0),d>=a?d=a-1:d<0&&(d=0);else if(!fa(e))throw new C("options.end type should be number.");if(d===e)return this;0<g!==d<e&&(g=-g);return this.then(function(){var a=new f,i=d,k=f.nextTick||f.delay,l=function(a){return a._type==="_ng"};a.cancel=k(function r(){var f=j?new D:null;do{if(!b||i in b)try{if((b?c[h](a,b[i],i,b):c[h](a,i))===false){a._run("_ng",null,l)[h]();return}}catch(m){a._run("_ng",[m],l)[h]();return}i+=g;if(d<e?i>=e:i<e){a[h]();return}}while(j&&new D-
f<j);a.cancel=k(r)});return a})}});f.wait=function(a){var b=new f,c=new D;b.cancel=(!a&&f.nextTick||f.delay)(function(){a?b[h](new D-c):b[h]()},a);return b};J(["then","when","each","loop"],function(a){f[a]=function(){return f.prototype[a][v](f.wait(0),arguments)}});typeof module===u&&(module.exports=t);return t}();