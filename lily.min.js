/*

   lily.js a.k.a. LIght LibrarY JavaScript (c) 2011 ofk
   lily is licensed under the MIT.
*/
var ll=function(){function q(a,b){function c(){this.init&&this.init.apply(this,arguments)}b||(b=a,a=null);if(a){var d=function(){};d.prototype=a.prototype;c.prototype=new d;var e=c.prototype,f;for(f in b)e[f]=b[f];e.parent=function p(a){p._proto_cache||(p._proto_cache={});var b=p._proto_cache;if(!(a in b)){b[a]=null;for(var d=c,d=e;!d.hasOwnProperty(a);)d=d.superConstructor,d=d.prototype;for(d=d.superConstructor;d;d=d.superConstructor)if(d=d.prototype,d.hasOwnProperty(a)){b[a]=d;break}}var f=b[a];
if(!f)throw new k(this+" has no method "+a);var g=this;return f.parent?function(){var b={},c;for(c in g)b[c]=g[c];b.parent=D?f.parent.bind(b):function(){return f.parent.apply(b,arguments)};var d=f[a].apply(b,arguments);delete b.parent;for(c in b)g[c]=b[c];return d}:D?f[a].bind(g):function(){return f[a].apply(g,arguments)}};e.superConstructor=a}else c.prototype=b;return c.prototype.constructor=c}function h(a){var b=typeof a;return E[b]||(b=E[K.call(a)])?b:!a?"null":a.setTimeout?"window":a.nodeType?
"node":"length"in a&&"number"===typeof(b=a.length)&&(!b||b-1 in a)?"array":"object"}function x(a,b,c){var d=0;if("array"===h(a))for(var e=a.length;d<e;++d){if(d in a&&!1===b.call(c,a[d],d,a))return!1}else for(d in a)if(a.hasOwnProperty(d)&&!1===b.call(c,a[d],d,a))return!1;return!0}function l(a){null==a&&(a={});for(var b=arguments,c=1,d=b.length;c<d;++c){var e=b[c];if(null!=e)for(var f in e)a[f]=e[f]}return a}function y(a,b){var b=b+"",c=a+"|"+b;return F[c]||(F[c]=b.replace(/^(_*)/,"$1"+a).toLowerCase())}
function G(a,b){var b=b+"",c=a+"|"+b;return H[c]||(H[c]=b.replace(/^(_*)(.|$)/,function(a,b,c){return b+c.toUpperCase()}))}function i(){}function u(){}function z(a,b){a.call(b+"change",b);a.call("change",b);a.call("_notify"+b)}function t(){}function A(a,b,c){switch(h(a)){case "boolean":return a;case "number":case "string":return""+b===""+a;case "regexp":return a.test(b);case "function":return!!a.call(c,b);default:return null}}function g(){}var D=!!Function.prototype.bind,m=window.document,I=isFinite,
k=TypeError,v=Date,B=Array.prototype.slice,K=Object.prototype.toString;l(q,{log:function(){var a=B.call(arguments);if(a.length)if(a.push("at "+new Date),window.console&&window.console.log)"apply"in console.log?console.log.apply(console,a):console.dir?console.dir(a):console.log(a);else if(m){var b=m.createElement("pre");b.className="console";b.appendChild(m.createTextNode(a.join(", ")));m.documentElement.appendChild(b)}},type:h,extend:l,each:x,Event:i,KVObject:u,Dispatch:t,Deferred:g});var E={undefined:1,
"boolean":1,number:1,string:1,"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object RegExp]":"regexp","[object Array]":"array","[object Function]":"function","[object Date]":"date"},F={},H={};l(i,{createHandle:function(){function a(){for(var b=a._llqueue,c=0,d=b.length;c<d;++c)!1===b[c].apply(this,arguments)&&(b.splice(c--,1),--d)}a._llqueue=[];return i.extendHandler(a,a._llqueue)},createFilter:function(){function a(){for(var b=a._llqueue,c=B.call(arguments),
d=0,e=b.length;d<e;++d)c[0]=b[d].apply(this,c);return c[0]}a._llqueue=[];return i.extendHandler(a,a._llqueue)},extendHandler:function(a,b){a.attach=function(a){if("function"!==h(a))throw new k("first argument type should be function.");b[b.length]=a};a.detach=function(a){for(var d=0,e=b.length;d<e;++d)if(a===b[d])return b.splice(d,1),!0;return!1};return a}});l(i.prototype,{attach:function(a,b){a=y("on",a);if(!this[a]||"function"!==h(this[a].attach))this[a]=i.createHandle();this[a].attach(b);return this},
detach:function(a,b){a=y("on",a);if(!this[a])return!0;var c=this[a];if("function"!==h(c.detach))throw new k("the handle function has no detach method.");return!b?(c._llqueue=[],!0):c.detach(b)},call:function(a){var a=y("on",a),b=this[a];if(b){if("function"!==h(b))throw new k("the handle function is not found.");return b.apply(this,B.call(arguments,1))}}});u.prototype=new i;l(u.prototype,{get:function(a){var b=this._llbindings;if(b&&(b=b[a]))return b.kvo.get(b.label);b=G("get",a);return this[b]&&"function"===
h(this[b])?this[b]():this[a]},set:function(a,b){var c=this._llbindings;if(c&&(c=c[a]))return c.kvo.set(c.label,b);c=G("set",a);this[c]&&"function"===h(this[c])?this[c](b):this[a]=b;z(this,a)},notify:function(a){var b=this._llbindings;if(b&&(b=b[a]))return b.kvo.notify(b.label);z(this,a)},bindTo:function(a,b,c,d){var e=this,c=c||a;if(!(b instanceof u))throw new k("second argument type should be [object ll.KVObject].");e.unbind(a);var f=e._llbindings=e._llbindings||{};f[a]={kvo:b,label:c};b.attach("_notify"+
c,f[a].notify=function(){z(e,a)});d||e.notify(a)},unbind:function(a){var b=this._llbindings,c;if(b)if(null==a)for(c in b)this.unbind(c);else if(c=b[a])delete b[a],c.kvo.detach("_notify"+c.label,c.notify),this.set(a,c.kvo.get(c.label))}});t.parseUrl=/^(\w*:\/\/)?(?:([^\/:@]+)?:([^\/:@]+)?@)?([\w\._-]+)?(?::(\d*))?(\/[^\?#]*)?(\?[^#]*)?(#.*)?$/;l(t.prototype,{update:function(a,b){null!=a&&(this._defaultLocation=a);this._defaultName=b||this._defaultName||"href"},match:function(a,b){(this._stash=this._stash||
[]).push({rule:a,callback:b});return this},call:function(){return this.run(this._defaultLocation,arguments)},run:function(a,b,c){var d=!1;if(a&&this._stash){var e=this._defaultName,f;if("string"===h(a)){var g=a,a={};a[e]=g}"pathname"in a||(f=t.parseUrl.exec(a[e]||""));f?l(a,{protocol:f[1]||"",hostname:f[4]||"",port:f[5]||"",pathname:f[6]||"",search:f[7]||"",hash:f[8]||""}):a=l({},a);for(var p in{pathname:1,search:1,hash:1})if(a[p]){e=p;break}c=c||a;b=b||[];f={};g=0;for(p=this._stash.length;g<p;++g){var C=
this._stash[g],r=a,i=f,j=e,n=C.rule,s=!0;if("object"!==h(n))s=A(n,r[j],r);else for(j in j=void 0,n){if(!(j in r)){s=!1;break}if("object"!==h(n[j])){if(!A(n[j],r[j],r)){s=!1;break}}else{if(!i[j]){i[j]={};for(var k=r[j].replace(/^\W+/,""),q=/([^&=]+)(?:=([^&]*))?/g,m;m=q.exec(k);)i[j][m[1]]=m[2]}var k=i[j],o;for(o in n[j])if(!A(n[j][o],k[o],k)){s=!1;break}if(!s)break}}if(s&&(d=!0,!1===C.callback.apply(c,b)))break}}return d}});"object"===typeof location&&(q.dispatch=new t,q.dispatch.update(location));
g.delay=function(a,b){var c=setTimeout(a,b*1E3);return function(){clearTimeout(c)}};var J="object"===typeof window,o,w;g.nextTick=J&&!window.opera&&(o=m)&&(w=o.head||o.getElementsByTagName("head")[0]||o.documentElement)?function(a){function b(){d=true;c.onload=c.onerror=c.onreadystatechange=null;w.removeChild(c)}var c=o.createElement("script"),d=false;c.async="async";c.src="data:text/javascript,";c.onload=c.onerror=c.onreadystatechange=function(){if(!d){b();a()}};w.insertBefore(c,w.firstChild);return b}:
J&&window.addEventListener?function(a){function b(){c();a()}function c(){d.removeEventListener("load",b,false);d.removeEventListener("error",b,false)}var d=new Image;d.addEventListener("load",b,false);d.addEventListener("error",b,false);d.src="data:image/png,"+Math.random();return c}:"object"===typeof process&&"function"===typeof process.nextTick?function(a){process.nextTick(a)}:null;l(g.prototype,{call:function(){return this._run("_ok",arguments)},fail:function(){return this._run("_ng",arguments)},
_run:function(a,b,c){var d=a,b=b||[];if(a in this){a=this[a];if(h(a)==="function")try{a=a.apply(this,b);d="_ok"}catch(e){a=e;d="_ng";g.onerror&&g.onerror(e)}if(a instanceof g){a._dfr=this._dfr;(!c||c(a))&&a._next(c);return this}b=[a]}this._type=d;this._args=b;(!c||c(this))&&this._next(c);return this},_next:function(a){this._type&&this._dfr&&this._dfr._run(this._type,this._args,a)},then:function(a){return this._set("_ok",a)},lose:function(a){return this._set("_ng",a)},_set:function(a,b){var c=new g;
c[a]=b;this._dfr=c;this._next();return c},wait:function(a){return this.then(function(){return g.wait(a)})},when:function(a){return this.then(function(){var b=new g,c=h(a)==="array"?[]:{},d=1;x(a,function(a,f){++d;h(a)==="function"&&(a=g.then(a));if(a instanceof g)a.then(function(a){c[f]=a;!--d&&b.call(c)}).lose(function(a){b._run("_ng",[a],function(a){if(a._type==="_ng")return true;!--d&&b.call(c);return false})});else{c[f]=a;!--d&&b.call(c)}});!--d&&b.call(c);return b})},each:function(a,b,c){return this._for(h(c)===
"number"?{time:c}:c,a,b)},loop:function(a,b){return this._for(h(a)==="number"?{end:a}:a,null,b)},_for:function(a,b,c){var a=l(null,a),d=+a.start||0,e=+a.end,f=+a.step||1,h=+a.time||0;if(b){a=b.length;!I(e)||e>a?e=a:e<0&&(e=0);d>=a?d=a-1:d<0&&(d=0)}else if(!I(e))throw new k("options.end type should be number.");if(d===e)return this;0<f!==d<e&&(f=-f);return this.then(function(){var a=new g,i=d,k=g.nextTick||g.delay,l=function(a){return a._type==="_ng"};a.cancel=k(function n(){var g=h?new v:null;do{if(!b||
i in b)try{if((b?c.call(a,b[i],i,b):c.call(a,i))===false){a._run("_ng",null,l).call();return}}catch(m){a._run("_ng",[m],l).call();return}i=i+f;if(d<e?i>=e:i<e){a.call();return}}while(h&&new v-g<h);a.cancel=k(n)});return a})}});g.wait=function(a){var b=new g,c=new v;b.cancel=(!a&&g.nextTick||g.delay)(function(){a?b.call(new v-c):b.call()},a);return b};x(["then","when","each","loop"],function(a){g[a]=function(){return g.prototype[a].apply(g.wait(0),arguments)}});"object"===typeof module&&(module.exports=
q);return q}(this);